<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Family Tree using D3.js</title>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
        }

        #familyTree {
            width: 100%;
            height: 100%;
        }

        .node {
            cursor: pointer;
        }

        .male {
            fill: #007BFF;
            width: 30px;
            height: 30px;
        }

        .female {
            fill: #FF63A5;
            r: 15;
        }

        .link {
            fill: none;
            stroke: #6c757d;
            stroke-width: 2px;
        }

        .label {
            font-size: 14px;
            text-anchor: middle;
        }

        .node text {
            font-size: 14px;
            text-anchor: middle;
            dominant-baseline: middle;
        }
    </style>
</head>
<body>

<svg id="familyTree">
</svg>

<script src="https://d3js.org/d3.v6.min.js"></script>
<script>
    // Family data with added grandparents
    const familyTreeData = {
        "people": [
		{ "id": 0, "name": "", "gender": "male" },
		{ "id": 1, "name": "Gilbert Bennett", "gender": "male" },  
		{ "id": 2, "name": "Caroline Bennett", "gender": "female" },   
		{ "id": 3, "name": "John Reynolds", "gender": "male" },   
		{ "id": 4, "name": "Lucille Reynolds", "gender": "female" },
		{ "id": 5, "name": "Jon Bennett", "gender": "male" },
		{ "id": 6, "name": "Anita Bennett", "gender": "female" },
		{ "id": 7, "name": "Dave Bennett", "gender": "male" },
		{ "id": 8, "name": "Mnke Bennett", "gender": "male" },
		{ "id": 9, "name": "Ryan Bennett", "gender": "male" },
		{ "id": 10, "name": "Rachael", "gender": "female" },
		{ "id": 11, "name": "Caroline Bennett", "gender": "female" },
        ],
	"relationships": [
		{ "parentId": 0, "childrenIds": [1, 2, 3, 4]},
		{ "parentId": 1, "partnerId": 2, "childrenIds": [5]},
		{ "parentId": 3, "partnerId": 4, "childrenIds": [6]},
		{ "parentId": 5, "partnerId": 6, "childrenIds": [7, 8, 9]},
		{ "parentId": 8, "partnerId": 10, "childrenIds": [] },
		{ "parentId": 8, "partnerId": 10, "childrenIds": [11] }
        ]
    };

    // Convert the flat family data into a hierarchical format for D3
    function buildHierarchy(data) {
        const peopleMap = new Map();
        data.people.forEach(person => {
            peopleMap.set(person.id, { ...person, children: [] });
        });

        data.relationships.forEach(rel => {
            const parent = peopleMap.get(rel.parentId);

            if (rel.partnerId) {
                const partner = peopleMap.get(rel.partnerId);
                parent.partner = partner;
            }

            if (rel.childrenIds) {
                rel.childrenIds.forEach(childId => {
                    const child = peopleMap.get(childId);
                    parent.children.push(child);
                });
            }
        });

        const roots = [];
        roots.push(peopleMap.get(0));
        return roots;
    }

    const width = window.innerWidth;
    const height = window.innerHeight;
    const margin = { top: 20, right: 90, bottom: 30, left: 90 };

    // Create the tree layout (reduce distance between people)
    const tree = d3.tree().size([height - margin.top - margin.bottom, width - margin.left - margin.right]);

    function handleZoom(e) {
      d3.select('svg g')
        .attr('transform', e.transform);
    }

    // Create an SVG container
    const svg = d3.select("#familyTree")
                  .attr("width", width)
                  .attr("height", height)
                  .append("g")
                  .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

    d3.select("#familyTree").call(d3.zoom().on("zoom", handleZoom))

    // Build the hierarchical data starting from Jon and Anita's family
    const roots = buildHierarchy(familyTreeData);

    // For each root, create a separate tree layout
    roots.forEach((rootData) => {
        const root = d3.hierarchy(rootData);
        const nodes = tree(root).descendants();
        const links = tree(root).links();

        // Draw the links (lines between family members)
        svg.selectAll(".link")
           .data(links)
           .enter().append("path")
           .attr("class", "link")
           .attr("d", d3.linkVertical()
               .x(d => d.x)
               .y(d => d.y + 30));  // Offset the links below the nodes to avoid overlapping

        // Draw the nodes (shapes for each family member)
        const node = svg.selectAll(".node")
                        .data(nodes)
                        .enter().append("g")
                        .attr("class", "node")
                        .attr("transform", d => "translate(" + d.x + "," + (d.y + 50) + ")"); // Offset the nodes slightly

        // Add rectangles for males and circles for females
        node.append("rect")
            .filter(d => d.data.gender === "male")
            .attr("class", "male")
            .attr("x", -15)
            .attr("y", -15);

        node.append("circle")
            .filter(d => d.data.gender === "female")
            .attr("class", "female")
            .attr("r", 15);

        // Add labels below each node
        node.append("text")
            .attr("class", "label")
            .attr("dy", 25) // Slightly offset text from the shape
            .text(d => d.data.name);
    });

    // Update the size of the SVG when the window is resized
    window.addEventListener('resize', function() {
        const newWidth = window.innerWidth;
        const newHeight = window.innerHeight;

        svg.attr("width", newWidth).attr("height", newHeight);

        // Adjust the tree layout to match the new size
        tree.size([newHeight - margin.top - margin.bottom, newWidth - margin.left - margin.right]);
        svg.selectAll(".link").remove();
        svg.selectAll(".node").remove();

        // Redraw the tree
        roots.forEach((rootData) => {
            const root = d3.hierarchy(rootData);
            const nodes = tree(root).descendants();
            const links = tree(root).links();

            svg.selectAll(".link")
               .data(links)
               .enter().append("path")
               .attr("class", "link")
               .attr("d", d3.linkVertical()
                   .x(d => d.x)
                   .y(d => d.y + 30));  // Offset the links below the nodes to avoid overlapping

            const node = svg.selectAll(".node")
                            .data(nodes)
                            .enter().append("g")
                            .attr("class", "node")
                            .attr("transform", d => "translate(" + d.x + "," + (d.y + 50) + ")"); // Offset the nodes slightly

            node.append("rect")
                .filter(d => d.data.gender === "male")
                .attr("class", "male")
                .attr("x", -15)
                .attr("y", -15);

            node.append("circle")
                .filter(d => d.data.gender === "female")
                .attr("class", "female")
                .attr("r", 15);

            node.append("text")
                .attr("class", "label")
                .attr("dy", 25) // Slightly offset text from the shape
                .text(d => d.data.name);
        });
    });
</script>
</body>
</html>

